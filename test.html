{% block content %}

<div class="container my-4">
  <div class="section active" id="add-property">
    <div class="content-header">
      <h1>Add Staff</h1>
      <div class="breadcrumb">
        <span>Home</span>
        <span>Add Staff</span>
      </div>
    </div>

    <form method="post" action="{% url 'add_staff' %}" enctype="multipart/form-data">
      {% csrf_token %}

        <!-- Property Information -->
        <div class="card property-form">
            <div class="card-header">
                <h2>Add Staff Form</h2>
            </div>
            
            <div class="card-body">

                <div class="input-group">
                    <div class="form-group">
                        <label>Staff Name</label>
                        <input type="text" name="name" class="form-control" placeholder="Enter Staff Name" required />
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" name="dob" class="form-control" required />
                    </div>
                </div>

                <div class="form-group">
                    <label>Email Id</label>
                    <input type="email" name="email" class="form-control" placeholder="Enter Email" required />
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" name="phone_number" class="form-control" placeholder="Enter Employee Mobile Number" required />
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact</label>
                        <input type="text" name="emergency_contact" class="form-control" placeholder="Enter Emergency Contact Number" required />
                    </div>
                </div>

                <div class="form-group">
                    <label>PF Number</label>
                    <input type="text" name="pf_number" class="form-control" placeholder="Enter PF Number" required />
                </div>
                
                <div class="input-group">
                    <div class="form-group">
                        <label>Bank Name</label>
                        <input type="text" name="bank_name" class="form-control" placeholder="Enter Bank Name" required />
                    </div>
                    <div class="form-group">
                        <label>Bank Account No.</label>
                        <input type="text" name="bank_account_number" class="form-control" placeholder="Enter Account Number " required />
                    </div>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>IFSC code</label>
                        <input type="text" name="ifsc_code" class="form-control" placeholder="Enter IFSC Code" required />
                    </div>
                    <div class="form-group">
                        <label>PAN No.</label>
                        <input type="text" name="pan_number" class="form-control" placeholder="Enter PAN Number " required />
                    </div>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>Mother Name</label>
                        <input type="text" name="mother_name" class="form-control" placeholder="Enter Mother Name" required />
                    </div>
                    <div class="form-group">
                        <label>Father Name</label>
                        <input type="text" name="father_name" class="form-control" placeholder="Enter Father Name" required />
                    </div>
                </div>

                <div class="form-group">
                    <label>Address</label>
                    <textarea name="address" class="form-control" placeholder="Enter Address" required></textarea>
                </div>

                <div class="form-group">
                    <label>Aadhar No.</label>
                    <input name="aadhar_number" class="form-control" placeholder="Enter Aadhar Number" required></input>
                </div>

                <div class="form-group">
                    <label class="form-label">Upload Photo</label>
                    <input type="file" name="upload_photo" class="form-control" multiple required />
                </div>

                <div class="form-group d-flex justify-content-end">
                    <button class="btn btn-primary" type="submit">Submit</button>
                </div>
            </div>
        </div>

    </form>
  </div>
</div>

{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="section active">
    <div class="content-header">
      <h1>Assign Task</h1>
      <div class="breadcrumb">
        <span>Home</span>
        <span>Assign Task</span>
      </div>
    </div>

    <form method="post" action="{% url 'assign_task' %}" enctype="multipart/form-data">
      {% csrf_token %}

        <div class="card property-form">
            <div class="card-header">
                <h2>Assign Task</h2>
            </div>
            
            <div class="card-body">
                <div class="form-group">
                    <label>Assign Date</label>
                    <input type="date" name="assign_date" class="form-control" required />
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>City</label>
                        <select name="city" class="form-control" required>
                            <option value="">Select City</option>
                            {% for hospital in hospitals %}
                                <option value="{{ hospital.city }}">{{ hospital.city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <select name="state" class="form-control" required>
                            <option value="">Select State</option>
                            {% for hospital in hospitals %}
                                <option value="{{ hospital.state }}">{{ hospital.state }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Hospital Name</label>
                    <select name="hospital_name" class="form-control" required>
                        <option value="">Select Hospital</option>
                        {% for hospital in hospitals %}
                            <option value="{{ hospital.hospital_name }}">{{ hospital.hospital_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>Hospital ID (Search)</label>
                        <select type="text" name="hospital_id" class="form-control" placeholder="Enter Hospital ID" required >
                          <option value="">Select Hospital ID</option>
                              {% for hospital in hospitals %}
                                  <option value="{{ hospital.id }}">{{ hospital.id }}</option>
                              {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Staff ID </label>
                        <select name="staff_id" class="form-control" required>
                          <option value="">Select Staff ID</option>
                            {% for person in staff %}
                                <option value="{{ person.id }}">{{ person.id }} - {{person.name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Task Type</label>
                    <select name="task_type" class="form-control" required>
                        <option value="">Select Task</option>
                        <option value="quotation_submitted">Quotation Submitted</option>
                        <option value="payment_follow_up">Payment follow up</option>
                        <option value="scrap_machine">Scrap Machine</option>
                        <option value="ncp_solution">NCP_Solution</option>
                        <option value="ncp_machine">NCP_Machine</option>
                        <option value="fmc_amc">FMC_AMC</option>
                        <option value="phone_call">Phone Call</option>
                        <option value="pts_visit">PTS_Visit</option>
                        <option value="citro_clear">Citro Clear</option>
                        <option value="pulmonary">Pulmonary</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" class="form-control" placeholder="Task Description" required></textarea>
                </div>

                <div class="form-group">
                    <label>Remarks</label>
                    <textarea name="remarks" class="form-control" placeholder="Task Remarks" required></textarea>
                </div>

                <div class="form-group">
                    <label>Follow Up Date</label>
                    <input type="date" name="follow_up_date" class="form-control" placeholder="Follow Up Date" required />
                </div>

                <div class="form-group d-flex justify-content-end">
                    <button class="btn btn-primary" type="submit">Submit</button>
                </div>
            </div>
        </div>

    </form>
  </div>
</div>

<script>
    // JavaScript to dynamically filter hospital names based on selected city and state
    document.addEventListener('DOMContentLoaded', function() {
        const citySelect = document.querySelector('select[name="city"]');
        const stateSelect = document.querySelector('select[name="state"]');
        const hospitalSelect = document.querySelector('select[name="hospital_name"]');

        function filterHospitals() {
            const selectedCity = citySelect.value;
            const selectedState = stateSelect.value;

            // Clear existing options
            hospitalSelect.innerHTML = '<option value="">Select Hospital</option>';

            {% for hospital in hospitals %}
                if ("{{ hospital.city }}" === selectedCity || "{{ hospital.state }}" === selectedState) {
                    const option = document.createElement('option');
                    option.value = "{{ hospital.id }}";
                    option.textContent = "{{ hospital.hospital_name }}";
                    hospitalSelect.appendChild(option);
                }
            {% endfor %}
        }

        citySelect.addEventListener('change', filterHospitals);
        stateSelect.addEventListener('change', filterHospitals);
    });

    
    // JavaScript to dynamically fill hospital name, city and state based on Hospital ID
    document.addEventListener('DOMContentLoaded', function() {
      const hospitalIdSelect = document.querySelector('select[name="hospital_id"]');
      const citySelect = document.querySelector('select[name="city"]');
      const stateSelect = document.querySelector('select[name="state"]');
      const hospitalSelect = document.querySelector('select[name="hospital_name"]');

      // Build a JS map of hospitals for quick lookup
      const hospitalsMap = {
        {% for hospital in hospitals %}
          "{{ hospital.id }}": {
            id: "{{ hospital.id }}",
            name: "{{ hospital.hospital_name|escapejs }}",
            city: "{{ hospital.city|escapejs }}",
            state: "{{ hospital.state|escapejs }}"
          }{% if not forloop.last %},{% endif %}
        {% endfor %}
      };

      function clearSelectValue(sel) {
        if (sel) sel.value = "";
      }

      hospitalIdSelect.addEventListener('change', function() {
        const selectedId = this.value;
        if (selectedId && hospitalsMap[selectedId]) {
          const h = hospitalsMap[selectedId];

          // Set city and state selects
          if (citySelect) citySelect.value = h.city;
          if (stateSelect) stateSelect.value = h.state;
          if (hospitalSelect) hospitalSelect.value = h.name;

          // Ensure hospital_name select has an option for this hospital and select it
          // if (hospitalSelect) {
          //   let opt = hospitalSelect.querySelector('option[value="' + h.id + '"]');
          //   if (!opt) {
          //     opt = document.createElement('option');
          //     opt.value = h.id;
          //     opt.textContent = h.name;
          //     hospitalSelect.appendChild(opt);
          //   }
          //   hospitalSelect.value = h.id;
          // }


          // Trigger change events so any other listeners can react (e.g., filtering)
          if (citySelect) citySelect.dispatchEvent(new Event('change'));
          if (stateSelect) stateSelect.dispatchEvent(new Event('change'));
          if (hospitalSelect) hospitalSelect.dispatchEvent(new Event('change'));
        } else {
          // Clear fields when no valid hospital selected
          clearSelectValue(citySelect);
          clearSelectValue(stateSelect);
          clearSelectValue(hospitalSelect);
        }
      });
    });

</script>

{% endblock %}


{% block content %}

<div class="container my-4">
  <div class="section active" id="add-property">
    <div class="content-header">
      <h1>Add Staff</h1>
      <div class="breadcrumb">
        <span>Home</span>
        <span>Add Staff</span>
      </div>
    </div>

    <form method="post" action="{% url 'add_staff' %}" enctype="multipart/form-data">
      {% csrf_token %}

        <!-- Property Information -->
        <div class="card property-form">
            <div class="card-header">
                <h2>Add Staff Form</h2>
            </div>
            
            <div class="card-body">

                <div class="input-group">
                    <div class="form-group">
                        <label>Staff Name</label>
                        <input type="text" name="name" class="form-control" placeholder="Enter Staff Name" required />
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" name="dob" class="form-control" required />
                    </div>
                </div>

                <div class="form-group">
                    <label>Email Id</label>
                    <input type="email" name="email" class="form-control" placeholder="Enter Email" required />
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" name="phone_number" class="form-control" placeholder="Enter Employee Mobile Number" required />
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact</label>
                        <input type="text" name="emergency_contact" class="form-control" placeholder="Enter Emergency Contact Number" required />
                    </div>
                </div>

                <div class="form-group">
                    <label>PF Number</label>
                    <input type="text" name="pf_number" class="form-control" placeholder="Enter PF Number" required />
                </div>
                
                <div class="input-group">
                    <div class="form-group">
                        <label>Bank Name</label>
                        <input type="text" name="bank_name" class="form-control" placeholder="Enter Bank Name" required />
                    </div>
                    <div class="form-group">
                        <label>Bank Account No.</label>
                        <input type="text" name="bank_account_number" class="form-control" placeholder="Enter Account Number " required />
                    </div>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>IFSC code</label>
                        <input type="text" name="ifsc_code" class="form-control" placeholder="Enter IFSC Code" required />
                    </div>
                    <div class="form-group">
                        <label>PAN No.</label>
                        <input type="text" name="pan_number" class="form-control" placeholder="Enter PAN Number" required />
                    </div>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label>Mother Name</label>
                        <input type="text" name="mother_name" class="form-control" placeholder="Enter Mother Name" required />
                    </div>
                    <div class="form-group">
                        <label>Father Name</label>
                        <input type="text" name="father_name" class="form-control" placeholder="Enter Father Name" required />
                    </div>
                </div>

                <div class="form-group">
                    <label>Address</label>
                    <textarea name="address" class="form-control" placeholder="Enter Address" required></textarea>
                </div>

                <div class="form-group">
                    <label>Aadhar No.</label>
                    <input name="aadhar_number" class="form-control" placeholder="Enter Aadhar Number" required></input>
                </div>

                <div class="form-group">
                    <label class="form-label">Upload Photo</label>
                    <input type="file" name="upload_photo" class="form-control" multiple required />
                </div>

                <div class="form-group d-flex justify-content-end">
                    <button class="btn btn-primary" type="submit">Submit</button>
                </div>
            </div>
        </div>

    </form>
  </div>
</div>

{% endblock %}